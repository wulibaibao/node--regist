/**
 * Created by sun on 2017/4/1.
 */
module.exports={
        login:(database,respond,request,callback)=>{
            database.query(`SELECT * FROM user_table WHERE username='${request.body.username}'`,(err,data)=>{	//登陆接口   数据库查询，根据用户名查询是否有此用户
                if(err){		//查询错误判断
                    res.send({"fild":"没有该用户"});
                }else {
                    var message = data[0];		//拿到数据解析
                    if(message != null || message != undefined){            //判断查询后的数据是否为空
                        if(message.password == request.body.password){			//判断表里密码是否一致
                            respond.send({"msg":"ok","reason":"登陆成功"});		//返回json
                            callback();
                        }else{
                            respond.send({"msg":"fild","reason":"密码错误"});
                            callback();
                        }
                    }else{
                        respond.send({"msg":"fild","reason":"暂无用户，请注册！"});
                        callback();
                    }
                }
            })
        },
        regist : (database,respond,request,callback)=>{
            database.query(`SELECT * FROM user_table WHERE account='${request.body.account}'`,(err,data)=>{			//查询表里是否有此字段
                if (err) {
                    console.log(err);
                    respond.send({"msg":"fild","reason":"数据错误"});
                }else {
                    if (data.account == null || data.account == undefined) {			//如果表里没有说明此用户表里没有  插入前台传入数据
                        console.log(request.body);
                        var sqlLang = `INSERT INTO user_table(account,username,password,telphone) VALUES ('${request.body.account}','${request.body.username}','${request.body.password}','${request.body.telphone}')`;
                        database.query(sqlLang,(err,data)=>{
                            if(err){
                                respond.send({"msg":"failde","reason":"数据错误，请重新提交"});
                                callback();
                            }else{
                            respond.send({"msg":"ok","reason":"恭喜您注册成功"});
                                callback();
                            }
                        });
                    }else{
                        respond.send({"msg":"error","reason":"账号已存在，请重新输入"});
                        callback();
                    }
                }
            })
        },
        chatRoom : (database,request,respones,callback)=>{
            database.query(`SELECT * FROM user_table`,(err,data)=>{
                respond.send({"msg":"ok","result":data});
                callback();
            })
        },
        messages:(database,request,respones,callback)=>{
            database.query(`SELECT * FROM chat_table`,(err,data)=>{
                respond.send({"msg":"ok","result":data});
                callback();
            })
        },
        submitMessage : (database,request,respones,callback)=>{
            database.query(`INSERT INTO chat_table() VALUES ()`,(err,data)=>{
                respond.send({"msg":"ok","reason":"ok"});
                callback();
            })
        }
}